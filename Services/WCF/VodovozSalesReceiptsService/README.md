# Приложение по автоматической фискализации чеков (интернет-магазина) "Модуль Касса"
## Общие сведения
Приложение периодически опрашивает нашу БД на наличие новых завершённых заказов.
При наличии заказов, клиентам которых нужно отправить чеки, приложение генерирует для каждого заказа
DTO объект кассового чека и отправляет его на сервер фискализации.
При разработке использовалась документация "API автоматической фискализации чеков интернет-магазинов (ver.1.4)"
(https://github.com/QualitySolution/VodovozService/blob/develop/VodovozSalesReceiptsService/Docs/API%20%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9%20%D1%84%D0%B8%D1%81%D0%BA%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8%20%D1%87%D0%B5%D0%BA%D0%BE%D0%B2%20%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82-%D0%BC%D0%B0%D0%B3%D0%B0%D0%B7%D0%B8%D0%BD%D0%BE%D0%B2%20(ver.1.4).pdf)

## Перед запуском
Перед запуском службы нужно в личном кабинете, к которому привязана касса, создать точку продаж, активировать
её, установить для неё опцию "Использовать для документов интернет-магазина", записать её идентификатор (вида 1234AbCd-12aB-XXXX-XXXX-XXXXXxxxXXXX).
Используя любую среду разработки API (например Postman) и логин+пароль к учётной записи МодульКасса, ассоциировать точку продаж, обратившись к API кассы
(https://my.modulkassa.ru/api/fn/v1/associate/1234AbCd-12aB-XXXX-XXXX-XXXXXxxxXXXX).
В полученном JSON объекте содержится имя пользователя и пароль которые необходимо внести в файл vodovoz-sales-receipts-service.json.
Дальнейшая переассоциация не требуется, если не меняется розничная точка или не произошла компрометация логина или пароля.

## Описание некоторых полей конфигурационного файла vodovoz-sales-receipts-service.json

Общий вид:
```json
{
  "Service": {
    "service_host_name": "Адрес приложения",
    "service_port": "Порт"
  },
  "ModulKassa": {
    "base_address": "Aдрес для обращения к API модуль кассы",
    "test_base_address": "Тестовый адрес для обращения к API"
  },
  "Mysql": {
    "mysql_server_host_name": "",
    "mysql_server_port": "",
    "mysql_user": "",
    "mysql_password": "",
    "mysql_database": ""
  },
  "Cashboxes": [
    {
      "Id": 1,
      "RetailPointName": "Имя розничной точки",
      "UserName": "Имя пользователя кассы",
      "Password": "Пароль от кассы"
    }
  ]
}
```
####test_base_address
Все документы на нём фискализируются без ошибок.
Учётные данные используются с реального сервиса Модуль Касса.
Необходима отдельная ассоциация точек продаж.
Все проведённые документы не будут фигурировать на реальном сервере, в ЛК их тоже не увидеть
